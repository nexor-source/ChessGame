

## 场景

#### 主菜单（匹配玩家开始游戏）

- 匹配玩家
- 退出游戏

#### 匹配页面？

#### 准备阶段（单位购买，进化）

- 玩家列表（位于屏幕最右侧，呈一列）
- 商店单位（位于屏幕左上侧，呈一排）
- 我方单位场（位于屏幕左下侧，为3*3的矩阵，最多可以放置9个单位）
- 空置3*3矩阵（位于屏幕右上侧，用于展示目前鼠标悬停单位的攻击方式）
- 金钱（位于屏幕最右下侧，是一个数字）

#### 战斗阶段（与匹配玩家进行回合制战斗）

- 我方单位场（位于屏幕左下侧，为3*3的矩阵，最多可以放置9个单位）
- 敌方单位场（位于屏幕右下侧，为3*3的矩阵，最多可以放置9个单位）
- 空置3*3矩阵（位于屏幕右上侧，用于展示目前鼠标悬停单位的攻击方式）
- 金钱（位于屏幕最右下侧，是一个数字）



## 单位

单位整体是处于一个矩形元素中，单位的图像（采用几何图形，如三角形，正方形，五边形，是否空心）占矩形元素大上半部分。

#### 属性

- 生命（单位所处矩形元素的右下角）
- 攻击方式（鼠标悬停到单位上时会在空置3*3矩阵中显示其攻击方式）
- 攻击（单位所处矩形元素的左下角）



## 机制

#### 主菜单匹配

与server进行通信，进入等待匹配的队列，当队列中的玩家达到$N_{max}$人  或者   当队列中的玩家达到$N_{min}$人且继续等待了$T$时间后，将队列中这些玩家进行匹配，使其进入到同一场游戏中

#### 购买单位

在准备阶段，商店会随机刷新3-4个单位出现在商店列表中，玩家可以拖动商店单位到我方单位场中的某个格子中，从而实现对单位的购买，在购买某单位后，在本轮准备阶段这个单位就从商店转移到了你的单位场中，也就意味着你无法从商店连续购买同一个单位数次。

#### 单位的重新排列与进化

在准备阶段，您可以任意调整单位在您单位场中所处的位置，你只需要拖动您的某个单位到单位场中的一个格子即可，如果那个格子为空，您的单位则会移到新的格子，如果那个格子已经有单位了，则会和那个格子已有的单位进行位置互换。*对于单位的进化暂时没有内容，忽略即可。*

#### 金钱

每轮准备阶段开始时，您都会获得`上次准备阶段的初始资金`+`1`+`刚刚对战您赢了吗?0:1`的金币数量，每一轮准备阶段没有消耗完的金币在战斗阶段结束后会清零。

#### 战斗阶段

在匹配到玩家进入战斗阶段前，所有玩家会向server进行通信，传输的内容为自己的单位场3*3大小的矩阵，矩阵中每个元素就是单位的id（每种单位都有独特的id号）。这样server就同步了目前所有玩家的单位场状态。

进入战斗阶段后，server会先随机决定玩家的先后行动顺序，并且将每方的所有单位进行随机排序（决定单位的攻击顺序），并对每个玩家x进行通信，传输内容就是：

- 对阵敌人的单位场结构
- 玩家x的先后手顺序
- 双方玩家所有单位的随机排序

在得到了这些内容后，客户端就可以完整演绎出战斗的过程（整个战斗阶段可以被理解成一场动画，玩家能做的只有看着，以及悬停到单位上查看单位的攻击方式）

之后开始演绎战斗过程，玩家双方交替轮流行动，每次是玩家的随机队列中排在最前面的单位进行行动，并且该单位行动完后进入到随机队列的队尾。

当一个单位死亡时，它在随机队列中也会被移出。

#### 战斗阶段到准备阶段的过度，以及如何开始下一个战斗阶段

在战斗阶段结束后（或者战斗阶段开始后1分钟），玩家会向server发送一个信号，表示已完成战斗。当收到来自所有玩家的战斗结束信号后，战斗阶段结束，所有玩家都处于准备阶段中。此时server开始一个60秒的倒计时，并且在60/30/10这三个时间点向所有玩家发送消息并提示，倒计时结束后结束准备阶段，重新开始战斗阶段。

先结束战斗阶段的玩家可以先进入准备阶段进行购买（因为商店生成随机单位是本地运算的，和server没有关系）

#### 淘汰

当玩家累计失败x次（暂定5次）后，游戏失败。玩家在结束战斗阶段后不是回到准备阶段，而是直接淘汰，回到主菜单。